\documentclass{article}

\usepackage[UTF8]{ctex}
\usepackage{xeCJK}
\usepackage{newtxtext}
\usepackage{geometry}
\usepackage{graphicx}
\usepackage[dvipsnames,svgnames]{xcolor}
\usepackage{float} 
\usepackage{subfigure}
\usepackage{tcolorbox}
\usepackage[strict]{changepage} % 提供一个 adjustwidth 环境
\usepackage{framed} % 实现方框效果
\usepackage{listings}%插入代码块
\geometry{a4paper,centering,scale=0.8}
% environment derived from framed.sty: see leftbar environment definition
\definecolor{formalshade}{RGB}{240,255,255} % 文本框颜色
\definecolor{formalshade1}{RGB}{240,255,240} % 文本框颜色
\definecolor{formalshade2}{RGB}{255,255,240} % 文本框颜色
% ------------------******-------------------
% 注意行末需要把空格注释掉，不然画出来的方框会有空白竖线
\newenvironment{formal1}{%
\def\FrameCommand{%
\hspace{1pt}%
{\color{Blue}\vrule width 2pt}%
{\color{formalshade}\vrule width 4pt}%
\colorbox{formalshade}%
}%
\MakeFramed{\advance\hsize-\width\FrameRestore}%
\noindent\hspace{-4.55pt}% disable indenting first paragraph
\begin{adjustwidth}{}{7pt}%
\vspace{2pt}\vspace{2pt}%
}
{%
\vspace{2pt}\end{adjustwidth}\endMakeFramed%
}
\usepackage{caption}
\usepackage[dvipsnames]{xcolor}  % 更全的色系
\usepackage{listings}  % 排代码用的宏包
\lstset{
 columns=fixed,       
 numbers=left,                                        % 在左侧显示行号
 numberstyle=\tiny\color{gray},                       % 设定行号格式
 frame=none, 
 keywordstyle=\color[RGB]{40,40,255},   % 设定关键字颜色
 numberstyle=\footnotesize\color{darkgray},           
 commentstyle=\it\color[RGB]{0,96,96},                % 设置代码注释的格式
 stringstyle=\rmfamily\slshape\color[RGB]{128,0,0},   % 设置字符串格式
 showstringspaces=false,                              % 不显示字符串中的空格
 language=c++,                                        % 设置语言
} 
% ------------------******-------------------
\newenvironment{formal2}{%
\def\FrameCommand{%
\hspace{1pt}%
{\color{Green}\vrule width 2pt}%
{\color{formalshade1}\vrule width 4pt}%
\colorbox{formalshade1}%
}%
\MakeFramed{\advance\hsize-\width\FrameRestore}%
\noindent\hspace{-4.55pt}% disable indenting first paragraph
\begin{adjustwidth}{}{7pt}%
\vspace{2pt}\vspace{2pt}%
}
{%
\vspace{2pt}\end{adjustwidth}\endMakeFramed%
}
% ------------------******-------------------
\newenvironment{formal3}{%
\def\FrameCommand{%
\hspace{1pt}%
{\color{Yellow}\vrule width 2pt}%
{\color{formalshade2}\vrule width 4pt}%
\colorbox{formalshade2}%
}%
\MakeFramed{\advance\hsize-\width\FrameRestore}%
\noindent\hspace{-4.55pt}% disable indenting first paragraph
\begin{adjustwidth}{}{7pt}%
\vspace{2pt}\vspace{2pt}%
}
{%
\vspace{2pt}\end{adjustwidth}\endMakeFramed%
}
\usepackage{indentfirst}
\setlength{\parindent}{2em}

% ------------------******-------------------
\begin{document}
\title{ \textbf{《音乐与数学》研究题:机器作曲·遗传算法\quad 实验报告}}
\author{组号4-25 \quad 
诸子瑜\quad 孙靖皓\quad 张洋\quad 徐艺宁 \quad 陈风凌}

\maketitle

\begin{center}
\tableofcontents
\end{center}

\newpage


\section{实验概述}

机器作曲是近年来人工智能领域的一个热门研究方向，其中遗传算法被广泛应用于生成音乐旋律。本实验旨在通过遗传算法生成音乐旋律，通过对初始种群的遗传迭代，探讨适应度函数的选取对最终音乐特性和算法效率的影响。

\section{分工}

\textbf{代码框架与训练}：陈风凌

\textbf{音乐片段选取}：徐艺宁

\textbf{数据预处理}：孙靖皓

\textbf{适应度函数}：诸子瑜

\textbf{代码部分内容填充}：张洋

\textbf{实验报告}：共同完成
\section{实验流程}
\subsection{数据处理}
使用python库music21实现乐谱与数据之间的转换。

\subsection{产生初始种群}
采用“从具有相同节拍的若干歌曲、乐曲中选取十个长度相等的片段”方法产生初始种群。选定节拍为44拍。为了保证旋律完整性，将长度设置为八小节。同时为保证调性一致，方便后续处理，将所有乐曲片段都进行了移调处理，得到C大调的初始种群。

在选择歌曲片段方面，主要考虑了节奏和旋律的丰富度，尽量减少样本内部的旋律重复。同时，选取了包含古典音乐、流行音乐在内的多种音乐风格，如《D大调卡农》、《青花瓷》等，使得初始种群的丰富度提高。

\subsection{遗传操作}
包括交叉 (crossover), 变异 (mutation) 以及对旋律进行
的移调、倒影、逆行变换等.

\section{各模块说明}
\subsection{population.py}
该模块包含了两个主要的类：Individual 和 Population。

\textbf{Individual类}
\quad Individual 类表示音乐的个体，即一个音乐片段。每个个体包含一个二维数组（melody），用于表示音符的音高和时值。

对个体应用变异三种变异方式：
改变音符的音高；改变音符的时值；转置、逆行、过渡。

\textbf{Population 类}
\quad Population 类表示音乐片段的群体，用于应用遗传算法。该类包含了一个音乐片段个体的列表，以及适应度函数和变异率等属性。


\subsection{preprocess.py}
该模块负责将音乐数据和数组之间进行转换，同时提供了生成音乐群体的功能。

\textbf{Converter 类}
\quad Converter 类包含了用于将音乐文件与数组之间进行转换的方法。

具体具体来说，Converter类中实现了四个方法：music2arrays，individual2music，array2music，generate\_population

\textbf{music2arrays}
\quad music2arrays的功能是读取一个.mid文件，将其中的音符流按音高和时值转化为一个二维数组，二维数组中的每一行包含8个整数，代表一个4/4拍小节中的8个八分音符，其中大于0的数字代表一个新的音符，而0代表当前音符的时值延长。

\textbf{individual2music}
\quad individual2music的功能是将一系列代表一段旋律的二维数组根据上述对应关系转化成.mid文件，并存储于某个文件路径中。

\textbf{array2music}
\quad array2music是individual2music的一个特殊情况，它只将一段单独的旋律转化为.mid文件。

\textbf{generate\_population}
\quad generate\_population的功能是读取某个.mid文件中的旋律，并生成一组包含该旋律的二维数组，以作为遗传算法中的初始种群使用。

\subsection{fitfuncion.py}
该模块实现了适应度函数 FitFunction，用于评估音乐片段的适应度。该适应度函数主要关注音高、音符时值、音高变化等方面的特征。



\section{适应度函数选取与音乐特性}



\section{实验结果}
在本实验中，适应度函数的设计是关键因素之一。通过调整适应度函数，可以引导算法更好地捕捉音乐的美感和规律。此外，遗传算法的效率也受到算法参数的影响，需要合理设置交叉、变异的概率以及其他相关参数，以平衡算法的收敛速度和生成的音乐质量。


通过遗传迭代，实验获得了一系列演化过程中的音乐片段。经过分析发现，适应度函数的选取直接影响了最终生成的旋律。合理的适应度函数能够引导算法朝着更和谐、富有创意的方向演化，而不合理的适应度函数可能导致生成的旋律缺乏音乐性。


\end{document}
